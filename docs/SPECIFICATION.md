# 仕様書

## 機能仕様

### 1. セッション管理

#### 1.1 セッション作成
- **台番号選択**: 1-9番台から選択（ボタングリッド形式）
- **フレーバー入力**: 任意入力 + 履歴からの選択
- **初期状態**: 作成時に「新規追加」イベントを自動記録

#### 1.2 セッション一覧表示
- **表示項目**:
  - 台番号（大きく強調）
  - フレーバー名（グリーン）
  - 最終メンテナンス（タイプ + 経過時間）
  - 総経過時間
- **ソート**: 台番号昇順
- **フィルター**: アクティブセッションのみ表示

#### 1.3 セッション終了
- **確認ダイアログ**: 誤操作防止のための確認
- **終了イベント記録**: 終了時刻とイベントを記録
- **状態変更**: `status: 'ended'` に更新

### 2. メンテナンス記録

#### 2.1 クイックアクション
3種類のメンテナンス作業をワンタップで記録：

| アクション | アイコン | カラー | 説明 |
|----------|---------|--------|------|
| すす捨て | Trash2 | シアン | 灰皿の清掃 |
| 炭交換 | Flame | ピンク | 炭の交換 |
| 調整 | Sliders | パープル | 火力調整 |

#### 2.2 記録内容
- **タイムスタンプ**: Unix時刻（ミリ秒）
- **イベントタイプ**: 'ash' | 'coal' | 'adjust'
- **Stand更新**: `lastActionType` と `lastActionAt` を更新
- **Event作成**: 履歴に新規イベントを追加

### 3. 経過時間の視覚化

#### 3.1 自動更新
- **更新間隔**: 60秒（60000ms）
- **更新対象**: すべての経過時間表示
- **実装**: `useEffect` + `setInterval`

#### 3.2 色分けルール
| 経過時間 | 表示色 | クラス | 意味 |
|---------|-------|--------|------|
| 0-10分 | デフォルト | - | 正常 |
| 10-15分 | 黄色 | text-yellow-400 | 注意 |
| 15分超過 | 赤色 | text-red-400 | 緊急 |

#### 3.3 時間計算
```typescript
// 切り上げ計算（1秒でも経過したら1分と表示）
elapsed = Math.ceil((currentTime - timestamp) / 60000)
```

### 4. 詳細画面

#### 4.1 表示情報
- **ヘッダー**: 台番号 + フレーバー名
- **メタ情報**: 作成日時、最終メンテナンス
- **クイックアクション**: すす捨て、炭交換、調整ボタン
- **履歴**: 最新10件のイベント（新しい順）

#### 4.2 インライン編集
- **フレーバー名**: クリックで編集モード、Enter/Escで確定/キャンセル
- **メモ**: 同様のインライン編集機能
- **即時保存**: 編集確定で即座にデータベース更新

#### 4.3 履歴表示
```typescript
イベント形式:
[時刻] [アイコン] [アクションタイプ]

例:
12:34 🗑️ すす捨て
12:15 🔥 炭交換
12:00 ➕ 新規追加
```

### 5. フレーバー履歴

#### 5.1 履歴の記録
- **記録タイミング**: セッション作成時（フレーバー入力があった場合）
- **取得方法**: すべてのStandからフレーバーを取得し、重複除去
- **並び順**: 最新のものが先（暗黙的にIDでソート）

#### 5.2 履歴の表示
- **トリガー**: フレーバー入力欄にフォーカス
- **表示件数**: 最大10件
- **表示方法**: ドロップダウン形式（入力欄の上部に表示）
- **選択動作**: クリックで入力欄に反映

## データモデル

### Stand（セッション）

```typescript
interface Stand {
  id: string;                   // UUID v4
  number: number;                // 台番号（1-9）
  flavor?: string;               // フレーバー名（任意）
  note?: string;                 // メモ（任意）
  status: 'active' | 'ended';    // セッション状態
  lastActionType?: ActionType;   // 最終アクション種別
  lastActionAt?: number;         // 最終操作時刻（Unix timestamp）
  endedAt?: number;              // 終了時刻（Unix timestamp）
}

type ActionType = 'create' | 'ash' | 'coal' | 'adjust';
```

### Event（履歴）

```typescript
interface Event {
  id: string;                    // UUID v4
  standId: string;               // 関連するStandのID（外部キー）
  type: EventType;               // イベントタイプ
  at: number;                    // 発生時刻（Unix timestamp）
  memo?: string;                 // メモ（オプション）
}

type EventType = 'create' | 'ash' | 'coal' | 'adjust' | 'note' | 'end';
```

### インデックス設計

```typescript
// Dexieスキーマ定義
stands: 'id, number, status, lastActionAt'
events: 'id, standId, at'
```

## デザイン仕様

### カラーパレット

#### ネオンカラー定義
```css
/* プライマリカラー */
--neon-cyan: #22d3ee;      /* すす捨て */
--neon-pink: #ec4899;      /* 炭交換 */
--neon-purple: #a855f7;    /* 調整 */
--neon-green: #22c55e;     /* フレーバー */
--neon-yellow: #fbbf24;    /* 追加 */
--neon-red: #ef4444;       /* 終了・警告 */

/* 背景カラー */
--slate-900: #0f172a;      /* 背景ベース */
--slate-800: #1e293b;      /* カード背景 */
--slate-700: #334155;      /* ボーダー */
```

### タイポグラフィ

#### フォント設定
- **和文**: システムフォント
- **見出し**: "Stick" フォント（ブランド名のみ）
- **本文**: デフォルトサイズ 14-16px
- **台番号**: 2xl（24px）、太字
- **ボタン**: xs-sm（12-14px）

### コンポーネントスタイル

#### ボタン
```css
基本スタイル:
- padding: 8-16px
- border: 2px solid (ネオンカラー)
- border-radius: 8px
- background: slate-900
- transition: all 200ms

ホバー:
- box-shadow: neon glow effect
```

#### カード
```css
- padding: 16px
- background: slate-800
- border: 1px solid slate-700
- border-radius: 8px
- hover: border-color: blue-400
```

#### モーダル
```css
オーバーレイ:
- background: rgba(0, 0, 0, 0.5)
- backdrop-blur: sm

コンテンツ:
- max-width: 28rem (448px)
- background: slate-800
- border: 2px solid (コンテキスト色)
```

### レイアウト

#### メイン画面
```
┌─────────────────────────────┐
│ ブランド名  [セッション追加] │
├─────────────────────────────┤
│ ┌───────────────────────┐   │
│ │ 1番台  ダブルアップル   │   │
│ │ 最終: すす捨て 5分前    │   │
│ │ 経過: 15分            │   │
│ │ [すす][炭][調] [詳細] │   │
│ └───────────────────────┘   │
│ ┌───────────────────────┐   │
│ │ 2番台  ミント         │   │
│ │ ...                  │   │
│ └───────────────────────┘   │
└─────────────────────────────┘
```

#### 詳細画面
```
┌─────────────────────────────┐
│ [←] 1番台  ダブルアップル   │
├─────────────────────────────┤
│ 作成: 2024/02/17 12:00     │
│ 最終: すす捨て 5分前        │
│                             │
│ [すす捨て][炭交換][調整]    │
│                             │
│ ┌─ 履歴 (最新10件) ───┐    │
│ │ 12:05 すす捨て       │    │
│ │ 12:00 新規追加       │    │
│ └─────────────────────┘    │
│                             │
│ [セッション終了]            │
└─────────────────────────────┘
```

### アニメーション

- **トランジション**: 200ms ease-in-out（標準）
- **ホバーエフェクト**: transform: scale(1.02)（ボタン）
- **ネオングロー**: box-shadow アニメーション
- **モーダル**: フェードイン 150ms

## PWA仕様

### マニフェスト

```json
{
  "name": "熾火守",
  "short_name": "熾火守",
  "description": "シーシャ台メンテナンス管理",
  "start_url": "/",
  "display": "standalone",
  "theme_color": "#0f172a",
  "background_color": "#0f172a",
  "orientation": "portrait-primary"
}
```

### アイコン生成

- **サイズ**: 192x192, 512x512
- **形式**: PNG
- **デザイン**: 動的生成（Canvas API）
- **内容**: "熾" + "火" の文字 + ネオンエフェクト

### オフライン対応

- **データ**: 完全にIndexedDBに保存
- **機能**: すべての機能がオフラインで利用可能
- **同期**: なし（ローカル専用）

## パフォーマンス要件

- **初期表示**: 2秒以内
- **操作レスポンス**: 100ms以内
- **データ読み込み**: 50ms以内
- **アニメーション**: 60fps維持

## ブラウザ対応

### 必須要件
- IndexedDB対応
- ES2020+ サポート
- CSS Grid & Flexbox

### 推奨環境
- Chrome/Edge 100+
- Safari 15+
- Firefox 100+

### PWAインストール
- Chrome/Edge: ネイティブサポート
- Safari (iOS): ホーム画面に追加
- Firefox: 実験的サポート

## セキュリティ

### データ保護
- すべてのデータはローカルに保存
- サーバー通信なし
- 外部への送信なし

### プライバシー
- 個人情報の収集なし
- トラッキングなし
- Cookieの使用なし

## アクセシビリティ

- セマンティックHTML使用
- ARIAラベル適用
- キーボード操作対応
- 高コントラスト（暗い環境想定）
