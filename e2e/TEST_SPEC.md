# E2Eテスト仕様書 - 熾火守（オキビモリ）

## テスト環境
- ブラウザ: Chrome
- テストフレームワーク: Playwright
- 対象URL: http://localhost:3000

## テストシナリオ

### 1. 初期表示テスト
**目的**: アプリケーションが正しく起動し、初期状態が正しいことを確認

| 試験項目 | 確認内容 | 期待結果 |
|---------|---------|---------|
| 1.1 | ページタイトル表示 | "熾火守" が表示される |
| 1.2 | メインヘッダー表示 | "オキビモリ" がネオンレッドで表示される |
| 1.3 | 空の状態メッセージ | "まず、セッションを追加してみてください♪" が表示される |
| 1.4 | セッション追加ボタン | "セッション追加" ボタンが表示される |

---

### 2. セッション作成テスト
**目的**: 新規セッションを正しく作成できることを確認

| 試験項目 | 操作手順 | 期待結果 |
|---------|---------|---------|
| 2.1 | セッション追加ボタンをクリック | フォームが表示される |
| 2.2 | 台番号に "1" を入力 | 入力された値が反映される |
| 2.3 | フレーバーに "ダブルアップル" を入力 | 入力された値が反映される |
| 2.4 | 追加ボタンをクリック | セッションが作成される |
| 2.5 | セッションカード表示 | "1番台" が表示される |
| 2.6 | フレーバー表示 | "ダブルアップル" がネオングリーンで表示される |
| 2.7 | 最終メンテ表示 | "最終メンテ: 新規追加 1分前" が表示される |
| 2.8 | 経過時間表示 | "経過時間: 1分" が表示される |

---

### 3. クイックアクション実行テスト
**目的**: クイックアクション（すす捨て、炭交換、調整）が正しく動作することを確認

#### 3.1 すす捨てアクション
| 試験項目 | 操作手順 | 期待結果 |
|---------|---------|---------|
| 3.1.1 | すす捨てボタンをクリック | アクションが記録される |
| 3.1.2 | 最終メンテ更新確認 | "すす捨て" アイコンとラベルが表示される |
| 3.1.3 | タイムスタンプ更新確認 | "1分前" が表示される |

#### 3.2 炭交換アクション
| 試験項目 | 操作手順 | 期待結果 |
|---------|---------|---------|
| 3.2.1 | 炭交換ボタンをクリック | アクションが記録される |
| 3.2.2 | 最終メンテ更新確認 | "炭交換" アイコン（ネオンピンク）とラベルが表示される |
| 3.2.3 | タイムスタンプ更新確認 | "1分前" が表示される |

#### 3.3 調整アクション
| 試験項目 | 操作手順 | 期待結果 |
|---------|---------|---------|
| 3.3.1 | 調整ボタンをクリック | アクションが記録される |
| 3.3.2 | 最終メンテ更新確認 | "調整" アイコン（ネオンパープル）とラベルが表示される |
| 3.3.3 | タイムスタンプ更新確認 | "1分前" が表示される |

---

### 4. 詳細ページ遷移テスト
**目的**: セッション詳細ページへ正しく遷移できることを確認

| 試験項目 | 操作手順 | 期待結果 |
|---------|---------|---------|
| 4.1 | 詳細ボタンをクリック | 詳細ページに遷移する |
| 4.2 | URL確認 | `/stands/[id]` にマッチする |
| 4.3 | 台番号表示 | "1番台" が表示される |
| 4.4 | フレーバー表示 | "ダブルアップル" が表示される |
| 4.5 | 戻るボタン表示 | "戻る" ボタンが表示される |
| 4.6 | クイックアクション表示 | 3つのアクションボタンが表示される |
| 4.7 | 履歴セクション表示 | "履歴 (最新10件)" が表示される |
| 4.8 | セッション終了ボタン表示 | "セッション終了" ボタンが表示される |

---

### 5. 詳細ページでのアクション実行テスト
**目的**: 詳細ページからクイックアクションを実行できることを確認

| 試験項目 | 操作手順 | 期待結果 |
|---------|---------|---------|
| 5.1 | すす捨てボタンをクリック | アクションが記録される |
| 5.2 | 履歴に追加確認 | 履歴リストの最上部に新しいアクションが表示される |
| 5.3 | アクション種別表示 | アイコンとラベルが正しく表示される |
| 5.4 | 時刻表示 | HH:MM 形式で時刻が表示される |
| 5.5 | 経過時間表示 | "(1分前)" が表示される |

---

### 6. セッション終了テスト
**目的**: セッションを正しく終了できることを確認

| 試験項目 | 操作手順 | 期待結果 |
|---------|---------|---------|
| 6.1 | セッション終了ボタンをクリック | 確認モーダルが表示される |
| 6.2 | モーダルタイトル確認 | "セッション終了の確認" が表示される |
| 6.3 | モーダルメッセージ確認 | "1番台 ダブルアップル" が表示される |
| 6.4 | キャンセルボタン確認 | "キャンセル" ボタンが表示される |
| 6.5 | 確認ボタン確認 | "終了する" ボタンが表示される |
| 6.6 | キャンセルをクリック | モーダルが閉じる、セッションは継続 |
| 6.7 | 再度セッション終了をクリック | 確認モーダルが再表示される |
| 6.8 | 終了するをクリック | メインページにリダイレクトされる |
| 6.9 | セッション削除確認 | セッションカードが表示されない |
| 6.10 | 空の状態確認 | "まず、セッションを追加してみてください♪" が表示される |

---

### 7. フレーバー履歴管理テスト
**目的**: 入力したフレーバーが次回の入力候補に表示されることを確認

| 試験項目 | 操作手順 | 期待結果 |
|---------|---------|---------|
| 7.1 | 1つ目のセッション作成（グレープ） | セッションが作成される |
| 7.2 | 2つ目のセッション作成開始 | セッション追加フォームが表示される |
| 7.3 | フレーバー入力欄をクリック | データリストが表示される |
| 7.4 | データリスト内容確認 | "グレープ" が候補に含まれる |
| 7.5 | 新しいフレーバー入力（ミント） | "ミント" を入力 |
| 7.6 | 3つ目のセッション作成開始 | セッション追加フォームが表示される |
| 7.7 | データリスト確認 | "グレープ" と "ミント" が候補に含まれる |

---

### 8. 複数セッション管理テスト
**目的**: 複数のセッションを同時に管理できることを確認

| 試験項目 | 操作手順 | 期待結果 |
|---------|---------|---------|
| 8.1 | 1番台セッション作成 | "1番台" が表示される |
| 8.2 | 2番台セッション作成 | "2番台" が表示される |
| 8.3 | 3番台セッション作成 | "3番台" が表示される |
| 8.4 | 全セッション表示確認 | 3つのセッションカードが表示される |
| 8.5 | 2番台のアクション実行 | 2番台の最終メンテが更新される |
| 8.6 | ソート順確認 | 最終メンテが最も古いセッションが上に表示される |

---

### 9. PWA機能テスト
**目的**: PWAとして正しく動作することを確認

| 試験項目 | 確認内容 | 期待結果 |
|---------|---------|---------|
| 9.1 | マニフェスト読み込み | `/manifest.webmanifest` が200を返す |
| 9.2 | アイコン読み込み | `/icon.png` が200を返す |
| 9.3 | アプリ名確認 | manifest の name が "熾火守" |
| 9.4 | 短縮名確認 | manifest の short_name が "熾火守" |

---

### 10. データ永続性テスト
**目的**: IndexedDBにデータが正しく保存されることを確認

| 試験項目 | 操作手順 | 期待結果 |
|---------|---------|---------|
| 10.1 | セッション作成 | セッションが表示される |
| 10.2 | ページリロード | F5キーで再読み込み |
| 10.3 | データ保持確認 | 作成したセッションが表示される |
| 10.4 | アクション実行 | クイックアクションを実行 |
| 10.5 | 詳細ページ遷移 | 詳細ページに移動 |
| 10.6 | 履歴確認 | 実行したアクションが履歴に表示される |

---

## テスト実行コマンド

```bash
# すべてのE2Eテストを実行
npm run test:e2e

# ヘッドレスモードで実行
npm run test:e2e:headless

# UIモードで実行（デバッグ用）
npm run test:e2e:ui

# 特定のテストファイルを実行
npx playwright test e2e/session-creation.spec.ts
```

## テスト環境のセットアップ

```bash
# Playwrightブラウザをインストール
npx playwright install

# 開発サーバーを起動（別ターミナル）
npm run dev

# テスト実行
npm run test:e2e
```

## 注意事項

1. テスト実行前に IndexedDB をクリアする必要がある場合があります
2. 時間依存のテストは、実行速度により結果が変わる可能性があります
3. E2Eテストは単体テストよりも実行時間が長くなります
4. CI/CD環境では、ヘッドレスモードで実行することを推奨します
